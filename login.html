<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- ‚úÖ Page Title -->
  <title>Retailers &amp; Offers ‚Äì Cashtraq</title>

  <!-- ‚úÖ Meta Description -->
  <meta name="description" content="Browse retailers and current cashback offers on Cashtraq. See percentages at a glance and favourite your top stores." />

  <!-- ‚úÖ Canonical -->
  <link rel="canonical" href="https://cashtraq.co.uk/retailers.html" />

  <!-- ‚úÖ Theme color -->
  <meta name="theme-color" content="#008080">

  <!-- ‚úÖ Open Graph / Twitter -->
  <meta property="og:title" content="Retailers &amp; Offers ‚Äì Cashtraq" />
  <meta property="og:description" content="Browse retailers and current cashback offers on Cashtraq. See percentages at a glance and favourite your top stores." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://cashtraq.co.uk/retailers.html" />
  <meta property="og:image" content="https://cashtraq.co.uk/assets/og-image.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Retailers &amp; Offers ‚Äì Cashtraq" />
  <meta name="twitter:description" content="Browse retailers and current cashback offers on Cashtraq. See percentages at a glance and favourite your top stores." />
  <meta name="twitter:image" content="https://cashtraq.co.uk/assets/og-image.png" />

  <!-- ‚úÖ Favicon & Styles -->
  <link rel="icon" type="image/png" href="assets/favicon.png" />
  <link rel="stylesheet" href="style.css" />

  <!-- ‚úÖ JSON-LD: CollectionPage + ItemList -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "CollectionPage",
    "name": "Cashtraq Retailers & Offers",
    "url": "https://cashtraq.co.uk/retailers.html",
    "isPartOf": { "@type": "WebSite", "url": "https://cashtraq.co.uk/" },
    "mainEntity": {
      "@type": "ItemList",
      "itemListElement": [
        { "@type": "ListItem", "position": 1, "item": { "@type": "Organization", "name": "Asda", "description": "Cashback: 5.0%" } },
        { "@type": "ListItem", "position": 2, "item": { "@type": "Organization", "name": "Tesco", "description": "Cashback: 3.5%" } },
        { "@type": "ListItem", "position": 3, "item": { "@type": "Organization", "name": "Ocado", "description": "Cashback: 2.0%" } }
      ]
    }
  }
  </script>

  <!-- ‚úÖ Chatbot + page-local styles -->
  <style>
    #chatbotToggle{
      position:fixed; bottom:20px; right:20px; background:#008080; color:#fff;
      border:none; border-radius:50%; width:60px; height:60px; font-size:28px;
      cursor:pointer; z-index:1000; display:flex; align-items:center; justify-content:center;
    }
    #chatbotToggle img{ width:28px; height:28px; }
    #chatbox{
      position:fixed; bottom:90px; right:20px; width:320px; max-height:450px;
      background:#fff; color:#333; border-radius:10px; box-shadow:0 8px 24px rgba(0,0,0,.2);
      padding:16px; display:none; flex-direction:column; z-index:1001; overflow-y:auto;
    }
    #chatbox h4{ margin-top:0; color:#008080; }
    .faq-question{ margin:10px 0; font-weight:600; cursor:pointer; color:#006666; }
    .faq-answer{ font-size:14px; margin-bottom:12px; display:none; }
    .faq-question.open + .faq-answer{ display:block; }
    body.dark-mode #chatbox{ background:#1e293b; color:#f1f5f9; }
    body.dark-mode .faq-question{ color:#38b2ac; }
    body.dark-mode .faq-answer{ color:#cbd5e1; }

    /* Retailer list */
    .retailer-list{ display:flex; flex-direction:column; gap:1rem; margin-top:2rem; }
    .retailer-card{
      display:flex; align-items:center; justify-content:space-between;
      background:#fff; border-radius:16px; box-shadow:0 4px 12px rgba(0,0,0,0.05);
      padding:1rem 1.5rem; transition:transform 0.2s;
    }
    .retailer-card:hover{ transform:scale(1.01); }
    .retailer-logo{ width:50px; height:50px; object-fit:contain; margin-right:1.25rem; }
    .retailer-details{ flex-grow:1; text-align:left; }
    .retailer-details strong{ font-size:1.2rem; display:block; margin-bottom:.25rem; }
    .retailer-details span{ font-size:.95rem; color:#555; }
    .retailer-actions{ display:flex; gap:.5rem; }
    .icon-button{
      font-size:1.25rem; background:#f0f0f0; border:none; border-radius:8px;
      padding:.5rem .75rem; cursor:pointer; transition:background .2s;
    }
    .icon-button:hover{ background:#e0e0e0; }

    /* Favourites visual state (optional) */
    .icon-button.is-fav { background:#ffe8ec; }
    .container.retailers{ max-width:600px; margin:0 auto; padding:2rem; }
    .logo-container.centered{ text-align:center; margin-bottom:1rem; }
    .logo-img{ max-width:400px; height:auto; }
    .section-heading{ text-align:center; font-size:1.6rem; margin-top:1.5rem; }
  </style>
</head>
<body>
  <!-- ‚ôø Skip to main content -->
  <a href="#main" class="sr-only sr-only-focusable" style="position:absolute;left:-9999px;width:1px;height:1px;overflow:hidden;">Skip to content</a>

  <div class="page-wrapper">
    <!-- üåô Dark mode toggle -->
    <button id="darkModeToggle" class="btn secondary" style="position:absolute; top:1rem; right:1rem;">üåì</button>

    <main id="main" class="main">
      <div class="container retailers">
        <!-- ‚úÖ Logo -->
        <div class="logo-container centered">
          <img src="assets/cashtraq_logo.svg" alt="Cashtraq Logo" class="logo-img" style="height:60px;" width="400" height="60" decoding="async" />
        </div>

        <!-- ‚úÖ Nav (includes Contact) -->
        <nav class="nav-links" style="text-align:center; margin-top:1rem;">
          <a href="dashboard.html" class="btn secondary">Dashboard</a>
          <a href="retailers.html" class="btn secondary active" aria-current="page">Retailers</a>
          <a href="profile.html" class="btn secondary">Profile</a>
          <a href="contact.html" class="btn secondary">Contact</a>
        </nav>

        <!-- ‚úÖ Heading -->
        <h2 class="section-heading">Retailers &amp; Offers</h2>

        <!-- ‚úÖ Retailer Cards -->
        <div class="retailer-list">
          <div class="retailer-card">
            <img src="assets/asda.png" alt="Asda Logo" class="retailer-logo" loading="lazy" decoding="async" width="50" height="50" />
            <div class="retailer-details">
              <strong>Asda</strong>
              <span>Cashback: 5.0%</span>
            </div>
            <div class="retailer-actions">
              <button class="icon-button" title="Favourite" aria-label="Favourite Asda">‚ô°</button>
              <button class="icon-button" title="Add" aria-label="Add Asda">+</button>
            </div>
          </div>

          <div class="retailer-card">
            <img src="assets/tesco.png" alt="Tesco Logo" class="retailer-logo" loading="lazy" decoding="async" width="50" height="50" />
            <div class="retailer-details">
              <strong>Tesco</strong>
              <span>Cashback: 3.5%</span>
            </div>
            <div class="retailer-actions">
              <button class="icon-button" title="Favourite" aria-label="Favourite Tesco">‚ô°</button>
              <button class="icon-button" title="Add" aria-label="Add Tesco">+</button>
            </div>
          </div>

          <div class="retailer-card">
            <img src="assets/ocado.png" alt="Ocado Logo" class="retailer-logo" loading="lazy" decoding="async" width="50" height="50" />
            <div class="retailer-details">
              <strong>Ocado</strong>
              <span>Cashback: 2.0%</span>
            </div>
            <div class="retailer-actions">
              <button class="icon-button" title="Favourite" aria-label="Favourite Ocado">‚ô°</button>
              <button class="icon-button" title="Add" aria-label="Add Ocado">+</button>
            </div>
          </div>
        </div>

        <!-- ‚úÖ Log Out Button -->
        <div style="text-align:center; margin-top:2rem;">
          <button onclick="logout()" class="btn secondary">Log Out</button>
        </div>
      </div>
    </main>

    <!-- ‚úÖ Footer -->
    <footer style="text-align:center; margin-top:2rem;">
      <a href="privacy.html">Privacy Policy</a> |
      <a href="terms.html">Terms &amp; Conditions</a> |
      <a href="faq.html">Help / FAQ</a> |
      <a href="contact.html">Contact</a>
    </footer>
  </div>

  <!-- ‚úÖ Cookie Consent Banner -->
  <div id="cookieConsent" role="region" aria-label="Cookie consent" style="position:fixed; bottom:1rem; left:1rem; right:1rem; background:#008080; color:#fff; padding:1rem; border-radius:8px; display:flex; justify-content:space-between; align-items:center; z-index:1000;">
    <span>We use cookies to improve your experience. By using our site, you accept our 
      <a href="privacy.html" style="color: #d1eaea; text-decoration: underline;">Privacy Policy</a>.
    </span>
    <button id="acceptCookies" style="background:#004d40; border:none; color:#fff; padding:0.5rem 1rem; border-radius:0.5rem; cursor:pointer;">Accept</button>
  </div>

  <!-- üí¨ Chatbot Button -->
  <button id="chatbotToggle" aria-label="Open Chatbot">
    <img src="assets/chatbot-icon.svg" alt="Chatbot Icon" />
  </button>

  <!-- üí¨ Chatbox -->
  <div id="chatbox" role="dialog" aria-modal="false" aria-label="Cashtraq Help Assistant">
    <h4>Cashtraq Help Assistant</h4>
    <div class="faq-item"><div class="faq-question">Where is my cashback?</div><div class="faq-answer">Cashback can take time to appear depending on the retailer. Most track within 72 hours, but some retailers take several weeks ‚Äî even up to 90 days ‚Äî to confirm transactions.</div></div>
    <div class="faq-item"><div class="faq-question">Why hasn‚Äôt my cashback tracked?</div><div class="faq-answer">Tracking may fail due to ad blockers, cookies being disabled, or if you didn‚Äôt click directly through Cashtraq to the retailer.</div></div>
    <div class="faq-item"><div class="faq-question">How long does cashback take to confirm?</div><div class="faq-answer">Retailers confirm cashback within a few days to 3 months, depending on return policies and transaction types.</div></div>
    <div class="faq-item"><div class="faq-question">How do loyalty tiers work?</div><div class="faq-answer">We offer Bronze, Silver, and Gold tiers based on total cashback earned.</div></div>
    <div class="faq-item"><div class="faq-question">Why is there a fee?</div><div class="faq-answer">We charge a small fee to consolidate cashback platforms into one app, saving you time and money.</div></div>
  </div>

  <!-- ‚úÖ Scripts -->
  <!-- Supabase client -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script>
    // üîå Supabase init
    const SUPABASE_URL = "https://xyxfqdpotxoaptwdhbfp.supabase.co";
    const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh5eGZxZHBvdHhvYXB0d2RoYmZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ5ODg3MTcsImV4cCI6MjA3MDU2NDcxN30.j_tkI5CMb_vtOx_LEtj0Odo7b4GiahTGsbFCHSbNxcM";
    window.supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON);

    // üîí OPTIONAL: lock this page behind login (uncomment to enforce)
    // (async () => {
    //   const { data: { session } } = await window.supabaseClient.auth.getSession();
    //   if (!session) window.location.replace('login.html');
    // })();

    // üåô Dark mode
    document.getElementById('darkModeToggle').addEventListener('click', () => {
      document.body.classList.toggle('dark-mode');
      localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
    });
    if (localStorage.getItem('darkMode') === 'true') {
      document.body.classList.add('dark-mode');
    }

    // üç™ Cookie Consent
    (function(){
      const cookieConsent = document.getElementById('cookieConsent');
      const acceptBtn = document.getElementById('acceptCookies');
      if (localStorage.getItem('cookiesAccepted') === 'true') {
        cookieConsent.style.display = 'none';
      }
      acceptBtn.addEventListener('click', () => {
        localStorage.setItem('cookiesAccepted', 'true');
        cookieConsent.style.display = 'none';
      });
    })();

    // üí¨ Chatbot toggle
    document.getElementById('chatbotToggle').addEventListener('click', function () {
      const chatbox = document.getElementById('chatbox');
      chatbox.style.display = chatbox.style.display === 'flex' ? 'none' : 'flex';
    });

    // ‚ùì FAQ toggles
    document.querySelectorAll('.faq-question').forEach(q => {
      q.addEventListener('click', () => q.classList.toggle('open'));
    });

    // ‚ù§Ô∏è Favourites (local persistence)
    (function () {
      const favs = JSON.parse(localStorage.getItem('favs') || '{}');
      document.querySelectorAll('.retailer-card').forEach(card => {
        const name = card.querySelector('.retailer-details strong')?.textContent.trim();
        if (!name) return;
        const btn = card.querySelector('.icon-button[aria-label^="Favourite"]');
        if (favs[name] && btn) {
          btn.classList.add('is-fav');
          btn.setAttribute('aria-pressed', 'true');
          btn.textContent = '‚ù§';
        }
      });
    })();

    document.addEventListener('click', (e) => {
      const btn = e.target.closest('.icon-button[aria-label^="Favourite"]');
      if (!btn) return;
      const card = btn.closest('.retailer-card');
      const name = card?.querySelector('.retailer-details strong')?.textContent.trim();
      if (!name) return;

      const favs = JSON.parse(localStorage.getItem('favs') || '{}');
      const isFav = !!favs[name];
      favs[name] = !isFav;
      localStorage.setItem('favs', JSON.stringify(favs));

      btn.classList.toggle('is-fav', !isFav);
      btn.setAttribute('aria-pressed', String(!isFav));
      btn.textContent = !isFav ? '‚ù§' : '‚ô°';
    });

    // üö™ Proper Supabase logout
    async function logout() {
      try {
        await window.supabaseClient.auth.signOut();
      } catch (e) {
        console.warn('Sign out error', e);
      } finally {
        localStorage.removeItem('isLoggedIn');
        window.location.href = 'login.html';
      }
    }
    // make available globally (in case inline onclick calls it)
    window.logout = logout;
  </script>
</body>
</html>
