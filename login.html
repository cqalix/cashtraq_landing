<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Log In - Cashtraq</title>

  <meta name="description" content="Log in to Cashtraq to view your dashboard, retailers and cashback activity." />
  <meta name="theme-color" content="#008080" />
  <link rel="canonical" href="https://cashtraq.co.uk/login.html" />

  <link rel="icon" type="image/png" href="assets/favicon.png" />
  <link rel="stylesheet" href="style.css?v=104" />
</head>

<body>
  <div class="page-wrapper">
    <!-- Dark mode -->
    <button
      id="darkModeToggle"
      class="btn secondary dark-toggle"
      type="button"
      aria-label="Toggle dark mode"
      title="Toggle dark mode"
    >ðŸŒ“</button>

    <main class="main">
      <div class="container" style="max-width:520px;">
        <div class="logo-container">
          <img
            src="assets/cashtraq_logo.svg"
            class="logo-img"
            alt="Cashtraq Logo"
            loading="eager"
            decoding="async"
          />
        </div>

        <h2>Log In</h2>

        <!-- Status / error messages -->
        <p id="loginStatus" class="muted" style="display:none; margin:0.5rem 0 0;">Signing inâ€¦</p>
        <p id="loginError" style="display:none; margin:0.5rem 0 0; color:#b00020;">&nbsp;</p>

        <!-- Login form -->
        <!-- IMPORTANT: app.js expects #loginForm and inputs #email + #password -->
        <form id="loginForm" autocomplete="on" style="margin-top:1rem;">
          <label for="email">Email</label>
          <input
            id="email"
            name="email"
            type="email"
            placeholder="you@example.com"
            autocomplete="email"
            required
          />

          <label for="password">Password</label>
          <input
            id="password"
            name="password"
            type="password"
            placeholder="Your password"
            autocomplete="current-password"
            required
          />

          <div style="width:100%; max-width:360px; text-align:left; margin-top:-0.5rem;">
            <label style="font-size:.9rem; display:flex; align-items:center; gap:.5rem; cursor:pointer;">
              <input type="checkbox" id="showPass" />
              Show password
            </label>
          </div>

          <button id="loginBtn" type="submit" class="btn">Log In</button>
        </form>

        <p style="margin-top:1rem;"><a href="forgot.html">Forgot your password?</a></p>

        <p style="margin-top:1rem;">New here? <a href="signup.html">Create an account</a></p>
      </div>
    </main>

    <footer>
      <a href="privacy.html">Privacy Policy</a> |
      <a href="terms.html">Terms &amp; Conditions</a> |
      <a href="faq.html">Help / FAQ</a> |
      <a href="contact.html">Contact</a>
    </footer>
  </div>

  <!-- LOGIN ANIMATION OVERLAY -->
  <div id="loginOverlay" class="login-overlay" hidden>
    <div class="login-overlay-inner" aria-label="Signing you in">
      <img src="assets/cashtraq_logo.svg" class="logo-form" alt="Cashtraq" />
      <div class="loading-dots" aria-hidden="true">
        <span></span><span></span><span></span>
      </div>
      <p class="loading-text">Signing you inâ€¦</p>
    </div>
  </div>

  <!-- Chatbot floating button -->
  <button
    id="chatbotToggle"
    class="chatbot-toggle"
    type="button"
    aria-label="Open Cashtraq Help Assistant"
    title="Help"
  >
    <img src="assets/chatbot-icon.svg" alt="" aria-hidden="true" />
  </button>

  <!-- Chatbot panel -->
  <div
    id="chatbox"
    class="chatbox"
    role="dialog"
    aria-modal="false"
    aria-label="Cashtraq Help Assistant"
    hidden
  >
    <div class="chatbox-header">
      <h4>Cashtraq Help Assistant</h4>
      <button id="chatbotClose" class="chatbox-close" type="button" aria-label="Close chatbot">âœ•</button>
    </div>
    <div class="chatbox-body"></div>
  </div>

  <!-- Cookie banner -->
  <div id="cookieConsent" class="cookie-banner" role="region" aria-label="Cookie consent">
    <span>
      We use cookies to improve your experience. See our
      <a href="privacy.html">Privacy Policy</a>.
    </span>
    <button id="acceptCookies" class="btn" type="button">Accept</button>
  </div>

  <!-- Shared JS (must be module for Supabase import in app.js) -->
  <script type="module" src="app.js?v=104"></script>

  <!-- Page-local helpers: show/hide password + trigger overlay on submit -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const showPass = document.getElementById("showPass");
      const pass = document.getElementById("password");
      const form = document.getElementById("loginForm");
      const overlay = document.getElementById("loginOverlay");
      const status = document.getElementById("loginStatus");
      const err = document.getElementById("loginError");

      if (showPass && pass) {
        showPass.addEventListener("change", (e) => {
          pass.type = e.target.checked ? "text" : "password";
        });
      }

      // Show the "banking app" overlay immediately on submit
      // (app.js still performs the real login + redirect)
      if (form && overlay) {
        form.addEventListener("submit", () => {
          if (status) {
            status.style.display = "block";
            status.textContent = "Signing inâ€¦";
          }
          if (err) err.style.display = "none";
          overlay.hidden = false;
        });
      }
    });
  </script>
</body>
</html>
